---
phase: 08-multi-scenario-comparison-export
plan: 02
type: execute
---

<objective>
Enable multi-scenario comparison mode where users can add, remove, and compare 2-4 configuration scenarios simultaneously.

Purpose: Allow users to explore multiple volume scenarios (A, B, C) and see all costs side-by-side in charts.
Output: Scenario management UI with dynamic configuration forms and multi-series chart visualization
</objective>

<execution_context>
./.claude/get-shit-done/workflows/execute-phase.md
./summary.md
./.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-multi-scenario-comparison-export/DISCOVERY.md
@.planning/phases/08-multi-scenario-comparison-export/08-01-SUMMARY.md
@.planning/codebase/STRUCTURE.md
@.planning/codebase/CONVENTIONS.md
@src/components/ComparisonLayout.tsx
@src/components/ComparisonChart.tsx
@src/types/comparison.ts
@src/index.css

**Tech stack available:**
- Recharts 3.3.0 with export functionality (from 08-01)
- Framer Motion 12.25.0 for animations
- Tailwind CSS with Material Design theme including dark mode

**Established patterns:**
- Local useState for page-level state
- Generic comparison framework using TypeScript generics
- cardVariants, fadeInUpVariants for animations
- AnimatePresence for enter/exit animations
- Dark mode via dark: variants

**Key decisions from Phase 7:**
- ThemeContext provides theme state
- All form inputs need dark: variants
- High contrast text pairs (neutral-900/100)

**From 08-01:**
- Chart export functionality integrated
- ResponsiveContainer has ref for PNG export

**Issues being addressed:**
- Users can only compare 2 configurations at once
- Cannot explore multiple volume scenarios simultaneously
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add multi-scenario types and state management</name>
  <files>src/types/comparison.ts, src/components/ComparisonLayout.tsx</files>
  <action>
In comparison.ts: Add Scenario interface with id (string), label (string), config (generic TConfig). Export type Scenario&lt;TConfig&gt; = { id: string; label: string; config: TConfig }.

In ComparisonLayout.tsx: Add enableMultiScenario?: boolean prop to ComparisonLayoutProps. Add conditional state: if enableMultiScenario, use useState&lt;Scenario&lt;TConfig&gt;[]&gt; for scenarios array (default 2 scenarios: A and B with defaultConfig1/2), otherwise keep existing config1/config2 state. Add helper functions: addScenario (max 4 scenarios, generate next letter), removeScenario (min 2 scenarios), updateScenarioConfig, updateScenarioLabel. Generate color palette for scenarios using Material Design colors: primary-500, secondary-500, purple-500, teal-500 (avoid confusion with cost-savings green or cost-increase red).
  </action>
  <verify>npm run build succeeds, TypeScript compiles without errors in comparison.ts and ComparisonLayout.tsx</verify>
  <done>Scenario type exists, multi-scenario state management implemented with add/remove/update functions</done>
</task>

<task type="auto">
  <name>Task 2: Build scenario management UI</name>
  <files>src/components/ComparisonLayout.tsx</files>
  <action>
When enableMultiScenario=true, replace grid-cols-2 layout with vertical stack of scenario cards. Each scenario card: header with color dot (matching chart color), editable label input (text input styled like form inputs with dark: variants), config form (existing ConfigForm component), cost breakdown (existing CostBreakdownComponent), remove button (X icon, disabled if &lt;= 2 scenarios, destructive red styling). Use AnimatePresence + motion.div with fadeInUpVariants for scenario add/remove animations. Below scenarios, add "Add Scenario" button (+ icon, disabled if scenarios.length >= 4, primary styling, disabled:opacity-50). Use flexbox with gap-6 for vertical spacing. All inputs need bg-white dark:bg-neutral-900 dark:text-neutral-100.
  </action>
  <verify>npm run build succeeds, no TypeScript errors</verify>
  <done>Scenario cards render with editable labels, config forms, cost breakdowns, and remove buttons. Add button creates new scenarios up to max 4.</done>
</task>

<task type="auto">
  <name>Task 3: Update ComparisonChart for multi-scenario support</name>
  <files>src/components/ComparisonChart.tsx</files>
  <action>
Add new prop variant: scenarios?: Array&lt;{ id: string; label: string; breakdown: GenericCostBreakdown; color: string }&gt;. If scenarios provided, use it; otherwise fall back to existing 2-config props (config1Label, config2Label, breakdown1, breakdown2). When using scenarios: build chartData from all scenario breakdowns (union of all categories across all scenarios), create Bar components dynamically using scenarios.map(s =&gt; &lt;Bar key={s.id} dataKey={s.label} fill={s.color} /&gt;). Update filename for export to include scenario count: aws-{service}-{scenarios.length}-scenarios.png vs aws-{service}-comparison.png. Keep all existing animations (500ms ease-in-out) and theme-aware styling.
  </action>
  <verify>npm run build succeeds, TypeScript compiles with new prop structure</verify>
  <done>Chart renders N scenarios dynamically with distinct colors, export filename reflects scenario count</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Multi-scenario comparison mode with dynamic scenario management</what-built>
  <how-to-verify>
    1. Run: npm run dev (if not running)
    2. To test, temporarily modify a service comparison page (e.g., S3Comparison.tsx) to pass enableMultiScenario={true} to ComparisonLayout
    3. Visit: http://localhost:5173/s3 (or whichever service you modified)
    4. Verify: See 2 scenario cards initially (Scenario A, Scenario B) instead of side-by-side layout
    5. Click "Add Scenario" - should add Scenario C card with animations
    6. Click "Add Scenario" again - should add Scenario D (button then disabled)
    7. Edit a scenario label - should update immediately
    8. Adjust configurations - chart should show all 4 scenarios with different colored bars
    9. Click remove (X) on Scenario D - should remove with animation, Add button re-enabled
    10. Try to remove when 2 scenarios remain - X buttons should be disabled
    11. Export chart - filename should be aws-s3-3-scenarios.png (or current count)
    12. Test in both light and dark themes - all inputs readable, chart colors distinct
    13. Revert temporary enableMultiScenario change after testing
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe any issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds without errors
- [ ] Scenario management UI renders correctly
- [ ] Add/remove scenarios works with min/max limits
- [ ] Chart displays all scenarios with distinct colors
- [ ] Label editing updates immediately
- [ ] Export includes all scenarios with correct filename
- [ ] No console errors or warnings
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Multi-scenario mode functional (when enabled via prop)
- Animations smooth for add/remove operations
- Chart scales to 2-4 scenarios correctly
- Export filenames reflect scenario count
- Phase 8 complete
</success_criteria>

<output>
After completion, create `.planning/phases/08-multi-scenario-comparison-export/08-02-SUMMARY.md`:

# Phase 8 Plan 2: Multi-Scenario Comparison Summary

**[Substantive one-liner - what shipped, not "phase complete"]**

## Performance

- **Duration:** [X] min
- **Started:** [timestamp]
- **Completed:** [timestamp]
- **Tasks:** 4 (3 auto, 1 checkpoint)
- **Files modified:** [N]

## Accomplishments

- Multi-scenario state management with Scenario type
- Scenario management UI with add/remove/edit functionality
- Dynamic chart rendering for 2-4 scenarios
- Animated scenario transitions with AnimatePresence
- Color-coded scenario visualization

## Task Commits

Each task was committed atomically:

1. **Task 1: Multi-scenario types and state** - [commit] (feat)
2. **Task 2: Scenario management UI** - [commit] (feat)
3. **Task 3: Multi-scenario chart support** - [commit] (feat)

**Plan metadata:** (to be committed)

## Files Created/Modified

- `src/types/comparison.ts` - Added Scenario type
- `src/components/ComparisonLayout.tsx` - Multi-scenario state and UI
- `src/components/ComparisonChart.tsx` - Dynamic scenario rendering

## Decisions Made

**State Management:**
- Used local useState with Scenario[] array instead of external state library
- Simple enough for page-local state, no need for Redux/Zustand

**UI Pattern:**
- Vertical stack of scenario cards instead of grid layout for better scalability
- Max 4 scenarios to keep chart readable

**Color Palette:**
- primary-500, secondary-500, purple-500, teal-500 for scenario differentiation
- Avoided green/red to prevent confusion with savings indicators

## Deviations from Plan

[Any auto-fixed issues or deferred enhancements]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

- Phase 8 complete: Multi-scenario comparison and export fully functional
- Export works for any number of scenarios (2-4)
- Ready for Phase 9: Cross-Service Cost Analysis

---
*Phase: 08-multi-scenario-comparison-export*
*Completed: [date]*
</output>
